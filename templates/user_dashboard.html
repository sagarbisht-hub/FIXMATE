{% extends 'base.html' %}

{% block content %}
<div class="dashboard">
    <nav class="dashboard-nav">
        <div class="logo"><i class="fas fa-tools"></i> FixMate AI</div>
        <div class="nav-right">
            <span>{{ user.first_name|default:user.username }}</span>
            <a href="{% url 'logout' %}" class="btn-logout">Logout</a>
        </div>
    </nav>
    
    <div class="dashboard-content">
        <div class="dashboard-header">
            <div>
                <h2>Welcome back, {{ user.first_name|default:user.username }}!</h2>
                <p>Track your service requests and their progress</p>
            </div>
            <button class="btn-primary" onclick="window.location.href='{% url 'create_job_form' %}'">
                <i class="fas fa-plus"></i> New Service Request
            </button>
        </div>
        
        <div class="dashboard-grid">
            <div class="main-content">
                <h3><i class="fas fa-list-ul"></i> Your Service Requests & Tracking</h3>
                
                {% for job in jobs %}
                <div class="job-card">
                    <div class="job-info">
                        <div class="job-icon">
                            <i class="fas fa-{{ job.category|lower|slice:':1' }}"></i>
                        </div>
                        <div>
                            <h4>{{ job.title }}</h4>
                            <p>{{ job.description|truncatewords:15 }}</p>
                            <div class="job-meta">
                                <span class="badge">{{ job.category }}</span>
                                <span class="date"><i class="far fa-clock"></i> {{ job.created_at|date:"M d, Y" }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="job-status">
                        <div>
                            <p class="label">Status</p>
                            <p class="status-{{ job.status }}">{{ job.status|upper }}</p>
                        </div>
                        {% if job.price %}
                        <div>
                            <p class="label">Price</p>
                            <p class="price">${{ job.price }}</p>
                        </div>
                        {% endif %}
                        <div>
                            <form method="POST" action="{% url 'delete_job' job.id %}" onsubmit="return confirm('Are you sure you want to delete this job?');" style="margin: 0;">
                                {% csrf_token %}
                                <button type="submit" class="btn-delete" title="Delete Job">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>No jobs yet. Create your first service request!</p>
                </div>
                {% endfor %}
            </div>
            
            <div class="sidebar">
                <div class="guarantee-card">
                    <h3>FixMate Guarantee</h3>
                    <p>Our AI ensures transparent pricing and high-quality work every single time.</p>
                    <div class="features">
                        <div><i class="fas fa-shield-alt"></i> Verified Professionals Only</div>
                        <div><i class="fas fa-hand-holding-usd"></i> Fair Pricing Algorithm</div>
                        <div><i class="fas fa-history"></i> 24/7 Priority Support</div>
                    </div>
                </div>
                
                <div class="workers-card">
                    <h3>Top Professionals</h3>
                    {% for worker in workers|slice:":3" %}
                    <div class="worker-item">
                        <img src="{{ worker.avatar }}" alt="{{ worker.user.first_name }}">
                        <div>
                            <p class="name">{{ worker.user.first_name }}</p>
                            <p class="skill">{{ worker.skills }}</p>
                        </div>
                        <span class="rating"><i class="fas fa-star"></i> {{ worker.rating }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<div id="jobModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>New Service Request</h3>
            <button onclick="closeJobModal()">&times;</button>
        </div>
        <form method="POST" action="{% url 'create_job' %}">
            {% csrf_token %}
            <div class="form-group">
                <label>Title</label>
                <input type="text" name="title" required placeholder="e.g., Fix broken electrical outlet">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Category</label>
                    <select name="category">
                        <option>Plumbing</option>
                        <option>Electrical</option>
                        <option>Carpentry</option>
                        <option>Cleaning</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Urgency</label>
                    <select name="urgency">
                        <option value="low">Routine (Low)</option>
                        <option value="medium">Urgent (Medium)</option>
                        <option value="high">Emergency (High)</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea name="description" required rows="3" placeholder="Explain what needs to be done..."></textarea>
            </div>
            <button type="submit" class="btn-submit">
                <i class="fas fa-magic"></i> Find Professionals
            </button>
        </form>
    </div>
</div>
{% endblock %}
